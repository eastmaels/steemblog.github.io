
<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
<title>justyy</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<link rel="icon" href="https://www.easyicon.net/api/resizeApi.php?id=1185564&size=32">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    




    
    

    
    
    
    

    
    

<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/@justyy/css/style.css">

<link rel="stylesheet" href="/@justyy/css/bundle.css"></head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/@justyy/">
            
                <img src="https://avatars0.githubusercontent.com/u/50857551?s=200&v=4" alt="justyy" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/@justyy/">Home</a>
                
                <a class="navbar-item" href="/@justyy/archives">Archives</a>
                
                <a class="navbar-item" href="/@justyy/categories">Categories</a>
                
                <a class="navbar-item" href="/@justyy/tags">Tags</a>
                
                <a class="navbar-item" href="/@justyy/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>

    
    <section class="section">
        <div class="container">
            <div class="columns">
                





<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left ">
    
        <div class="card widget">
  <div class="card-content">
    <div id="widget-profile" data-pjax="/@justyy/widgets/profile.html" style="position: relative; width: 100%; display: block;"></div>
  </div>
</div>



    
        <div class="card widget">
  <div class="card-content">
    <div id="widget-category" data-pjax="/@justyy/widgets/category.html" style="position: relative; width: 100%; display: block;"></div>
  </div>
</div>



    
        <div class="card widget">
  <div class="card-content">
    <div id="widget-tagcloud" data-pjax="/@justyy/widgets/tagcloud.html" style="position: relative; width: 100%; display: block;"></div>
  </div>
</div>



    
        <div class="card widget">
  <div class="card-content">
    <div id="widget-tag" data-pjax="/@justyy/widgets/tag.html" style="position: relative; width: 100%; display: block;"></div>
  </div>
</div>



    
    
        <div class="column-right-shadow is-hidden-widescreen ">
        
            

        
            <div class="card widget">
  <div class="card-content">
    <div id="widget-recent_posts" data-pjax="/@justyy/widgets/recent_posts.html" style="position: relative; width: 100%; display: block;"></div>
  </div>
</div>



        
            <div class="card widget">
  <div class="card-content">
    <div id="widget-archive" data-pjax="/@justyy/widgets/archive.html" style="position: relative; width: 100%; display: block;"></div>
  </div>
</div>



        
        </div>
    
</div>


                





<div class="column is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only has-order-3 column-right ">
    
        

    
        <div class="card widget">
  <div class="card-content">
    <div id="widget-recent_posts" data-pjax="/@justyy/widgets/recent_posts.html" style="position: relative; width: 100%; display: block;"></div>
  </div>
</div>



    
        <div class="card widget">
  <div class="card-content">
    <div id="widget-archive" data-pjax="/@justyy/widgets/archive.html" style="position: relative; width: 100%; display: block;"></div>
  </div>
</div>



    
    
</div>


                <script src="/@justyy/js/pjax-widget.js"></script>

                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <div class="card">
    
    <div class="card-image">
        <a href="/@justyy/steemjs-programming-what-happens-on-the-steem-blockchain-in-the-last-24-hours/" class="image is-7by1">
            <img class="thumbnail" src="https://steemyy.com/images/vote-for-justyy.jpg" alt="SteemJs Programming: What Happens on the Steem Blockchain in the Last 24 Hours?">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-06-11T19:10:21.000Z">2020-06-11</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/@justyy/categories/whalepower/">whalepower</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 475 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/@justyy/steemjs-programming-what-happens-on-the-steem-blockchain-in-the-last-24-hours/">SteemJs Programming: What Happens on the Steem Blockchain in the Last 24 Hours?</a>
            
        </h1>
        <div class="content">
            <p>Many questions are interesting but the answers are not obvious or easy to get. For example:  Who comments most in the last 24 hours?</p>
<p>I am going to show you a pattern to find out the answers to such questions using <a href="https://steemyy.com/steemjs/" target="_blank" rel="noopener">SteemJs</a>. </p>
<h2 id="Get-Current-Lastest-Block"><a href="#Get-Current-Lastest-Block" class="headerlink" title="Get Current Lastest Block"></a>Get Current Lastest Block</h2><p>We need to get the latest block number on the steem blockchain, and we can work out roughly the last 24 hours block range by subtracting 20<em>60</em>24 (3 seconds a block).</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function getBlockchainData() {</span><br><span class="line">    return new Promise((resolve, reject) =&gt; {</span><br><span class="line">      steem.api.getDynamicGlobalProperties(function(err, result) {</span><br><span class="line">          if (!err) {</span><br><span class="line">              resolve(result);</span><br><span class="line">          } else {</span><br><span class="line">              reject(err);</span><br><span class="line">          }</span><br><span class="line">      });</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>The current block number is:</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const blockchain = await getBlockchainData();</span><br><span class="line">const maxBlock = blockchain.head_block_number;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Getting-the-Block-Content"><a href="#Getting-the-Block-Content" class="headerlink" title="Getting the Block Content"></a>Getting the Block Content</h2><p>Each block contains transactions, here you would need to parse the list of transactions and look for the particular ones that you are interested. For example, if we want to compute the total producer rewards by witnesses, we can look for &#x201C;producer_reward&#x201D;.</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function getBlock(block) {</span><br><span class="line">    return new Promise((resolve, reject) =&gt; {</span><br><span class="line">        steem.api.getOpsInBlock(block, false, function(err, result) {</span><br><span class="line">          if (!err) {</span><br><span class="line">              const txCount = result.filter(x=&gt;x.virtual_op===0).length;</span><br><span class="line">              const producer = result.filter(x=&gt;x.op[0] === &quot;producer_reward&quot;);</span><br><span class="line">              const witness = producer[0].op[1].producer;</span><br><span class="line">              const reward = producer[0].op[1].vesting_shares;</span><br><span class="line">              resolve({</span><br><span class="line">                count: txCount,</span><br><span class="line">                witness: witness,</span><br><span class="line">                reward: reward.replace(&quot; VESTS&quot;, &quot;&quot;),</span><br><span class="line">                time: producer[0].timestamp.replace(&quot;T&quot;, &quot; &quot;)</span><br><span class="line">              });</span><br><span class="line">          } else {</span><br><span class="line">              reject(err);</span><br><span class="line">          }        </span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h2 id="Writing-to-Database-or-a-File"><a href="#Writing-to-Database-or-a-File" class="headerlink" title="Writing to Database or a File"></a>Writing to Database or a File</h2><p>We need to write the data into a database, or for simplicity, we can write to a CSV file for later process.</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">(async function() {</span><br><span class="line">    const blockchain = await getBlockchainData();</span><br><span class="line">    const maxBlock = blockchain.head_block_number;</span><br><span class="line">    for (let block = maxBlock - 20*60*24; block &lt;= maxBlock; ++ block) {</span><br><span class="line">        try {</span><br><span class="line">            const data = await getBlock(block);</span><br><span class="line">            const s = &apos;&quot;&apos; + data.time + &apos;&quot;,&apos; + block + &apos;,&quot;&apos; + data.witness + &apos;&quot;,&apos; + data.count + &quot;,&quot; + data.reward + &quot;\n&quot;;</span><br><span class="line">            log(s);</span><br><span class="line">            fs.appendFileSync(&apos;data.csv&apos;, s);</span><br><span class="line">        } catch (e) {</span><br><span class="line">            log(e);</span><br><span class="line">        }</span><br><span class="line">    }  </span><br><span class="line">})();</span><br></pre></td></tr></tbody></table></figure>
<p>Of course, if you want to further develop into a tool, you would need a database, and a background daemon that automatically syncs with the <a href="https://helloacm.com/illustrating-the-blockchain-via-steemjs-blocks-are-chained/" target="_blank" rel="noopener">blockchain</a>.</p>
<hr>

<p>Every little helps! I hope this helps!</p>
<p><strong>Steem On!~</strong></p>
<h2 id="Reposted-to-Blog"><a href="#Reposted-to-Blog" class="headerlink" title="Reposted to Blog"></a><em>Reposted to <a href="https://helloacm.com/steemjs-programming-what-happens-on-the-steem-blockchain-in-the-last-24-hours/" target="_blank" rel="noopener">Blog</a></em></h2><p>If you like my work, please consider voting for me, thanks!<br><a href="https://steemit.com/~witnesses" target="_blank" rel="noopener">https://steemit.com/~witnesses</a> type in <strong>justyy</strong> and click <strong><em>VOTE</em></strong><br><img src="https://steemyy.com/images/vote-for-justyy.jpg" alt=""></p>
<p><br><br><strong>Alternatively, you could <a href="https://steemyy.com/witness-voting/?witness=justyy&amp;action=proxy" target="_blank" rel="noopener">proxy to me</a>  if you are too lazy to vote!</strong></p>
<p>Also: you can vote me at the tool I made:  <a href="https://steemyy.com/witness-voting/?witness=justyy" target="_blank" rel="noopener">https://steemyy.com/witness-voting/?witness=justyy</a></p>
<h3 id="Visit-me-at-https-steemyy-com"><a href="#Visit-me-at-https-steemyy-com" class="headerlink" title="Visit me at:  https://steemyy.com"></a>Visit me at:  <a href="https://steemyy.com" target="_blank" rel="noopener">https://steemyy.com</a></h3><hr>
<p>This page is synchronized from the post: <a href="https://steemit.com/@justyy/steemjs-programming-what-happens-on-the-steem-blockchain-in-the-last-24-hours" target="_blank" rel="noopener">&#x2018;SteemJs Programming: What Happens on the Steem Blockchain in the Last 24 Hours?&#x2019;</a></p>
<script>document.querySelectorAll(".not-gallery-item").forEach(e=>{if(!e.dataset.src)return;const t=document.createElement("img");t.style="display:none !important;",t.src=e.dataset.src,t.addEventListener("error",()=>{t.remove(),e.style.color="inherit",e.style.backgroundImage="none",e.style.background="none"}),t.addEventListener("load",()=>{t.remove()}),document.body.appendChild(t)});</script>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/@justyy/new-tool-steem-witness-update-tool/" class="image is-7by1">
            <img class="thumbnail" src="https://cdn.steemitimages.com/DQmNMcwBSWyFbnijYvMoBdePRCgyosskve1KzJL2zB9B2ba/image.png" alt="New Tool: Steem Witness Update Tool">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-06-10T18:12:54.000Z">2020-06-10</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/@justyy/categories/witness-category/">witness-category</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 234 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/@justyy/new-tool-steem-witness-update-tool/">New Tool: Steem Witness Update Tool</a>
            
        </h1>
        <div class="content">
            <p>Added another tool to broadcast witness update:</p>
<p>Tool URL: <a href="https://steemyy.com/witness-update/" target="_blank" rel="noopener">https://steemyy.com/witness-update/</a><br>Chinese: <a href="https://steemyy.com/witness-update-tool/" target="_blank" rel="noopener">https://steemyy.com/witness-update-tool/</a></p>
<h1 id="What-this-tool-can-do-for-you"><a href="#What-this-tool-can-do-for-you" class="headerlink" title="What this tool can do for you?"></a>What this tool can do for you?</h1><p>Usually, I send update using the <code>conductor</code> directly on my witness server. But sometimes when you are not able to SSH, this tool would be handy.</p>
<p>Click &#x201C;Get Witness Information&#x201D; which will retrieve the current Witness Data and populate in the fields.<br><img src="https://cdn.steemitimages.com/DQmNMcwBSWyFbnijYvMoBdePRCgyosskve1KzJL2zB9B2ba/image.png" alt="image.png"></p>
<p>A friendly advice: Set Signing Key to  <code>STM1111111111111111111111111111111114T1Anm</code> to take your witness offline if you are not able to make it! (to avoid missing blocks and be voted out)</p>
<hr>

<p>Every little helps! I hope this helps!</p>
<h2 id="Steem-On"><a href="#Steem-On" class="headerlink" title="Steem On!~"></a><strong>Steem On!~</strong></h2><p>If you like my work, please consider voting for me, thanks!<br><a href="https://steemit.com/~witnesses" target="_blank" rel="noopener">https://steemit.com/~witnesses</a> type in <strong>justyy</strong> and click <strong><em>VOTE</em></strong><br><img src="https://steemyy.com/images/vote-for-justyy.jpg" alt=""></p>
<p><br><br><strong>Alternatively, you could <a href="https://steemyy.com/witness-voting/?witness=justyy&amp;action=proxy" target="_blank" rel="noopener">proxy to me</a>  if you are too lazy to vote!</strong></p>
<p>Also: you can vote me at the tool I made:  <a href="https://steemyy.com/witness-voting/?witness=justyy" target="_blank" rel="noopener">https://steemyy.com/witness-voting/?witness=justyy</a></p>
<h3 id="Visit-me-at-https-steemyy-com"><a href="#Visit-me-at-https-steemyy-com" class="headerlink" title="Visit me at:  https://steemyy.com"></a>Visit me at:  <a href="https://steemyy.com" target="_blank" rel="noopener">https://steemyy.com</a></h3><hr>
<p>This page is synchronized from the post: <a href="https://steemit.com/@justyy/new-tool-steem-witness-update-tool" target="_blank" rel="noopener">&#x2018;New Tool: Steem Witness Update Tool&#x2019;</a></p>
<script>document.querySelectorAll(".not-gallery-item").forEach(e=>{if(!e.dataset.src)return;const t=document.createElement("img");t.style="display:none !important;",t.src=e.dataset.src,t.addEventListener("error",()=>{t.remove(),e.style.color="inherit",e.style.backgroundImage="none",e.style.background="none"}),t.addEventListener("load",()=>{t.remove()}),document.body.appendChild(t)});</script>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/@justyy/how-to-set-up-your-on-call-duty-when-your-witness-is-missing-a-block/" class="image is-7by1">
            <img class="thumbnail" src="https://cdn.steemitimages.com/DQmeUtmtxvsoPnZiqntQTc8HLa4nGfGs1viShbKWwNGzZ3W/image.png" alt="How to Set Up Your On-Call Duty when Your Witness is Missing a Block?">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-06-09T18:23:24.000Z">2020-06-09</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/@justyy/categories/witness-tool/">witness-tool</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    5 minutes read (About 680 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/@justyy/how-to-set-up-your-on-call-duty-when-your-witness-is-missing-a-block/">How to Set Up Your On-Call Duty when Your Witness is Missing a Block?</a>
            
        </h1>
        <div class="content">
            <p>What is On-Call? You know many Software Engineers at Big Companies need to do On-Call Duties to fix service related issues when they arise.</p>
<p>Yesterday, I presented a utility to switch your <a href="https://helloacm.com/steem-witness-replay-time-takes-longer-and-longer/" target="_blank" rel="noopener">node</a> in case of missing too many blocks. But wouldn&#x2019;t it be a lot nicer if we can be notified (be paged) when this happens?</p>
<p>Please be warned that if you like less intrusive notification, you should go for SMS (which should be easy to set up using the method below) or even just email.</p>
<p>Post: <a href="https://steemit.com/witness-category/@justyy/open-source-auto-switch-your-witness-node-in-the-event-of-failure" target="_blank" rel="noopener">Open Source: Auto Switch Your Witness Node In the Event of Failure</a><br>Open Source Utility: <a href="https://github.com/DoctorLai/SteemWitnessAutoSwitch" target="_blank" rel="noopener">https://github.com/DoctorLai/SteemWitnessAutoSwitch</a></p>
<p>This is how we can set up the on-call when missing blocks.</p>
<h1 id="IFTTT"><a href="#IFTTT" class="headerlink" title="IFTTT"></a>IFTTT</h1><p>You may have heard of <a href="https://helloacm.com/adding-ifttt-to-steemit/" target="_blank" rel="noopener">IFTTT</a> which stands for If This Then That. This is a powerful service that allows you to connect two or more services. </p>
<p>First, you would need to register a IFTTT account, then you would need to connect the &#x201C;Webhooks&#x201D; service which allows you to send a message to the hook. Then, the &#x201C;That&#x201D; part would be to connect the &#x201C;Voip Call&#x201D; part which will call you - alternatively, you could choose other notification methods such as SMS or Emails, or even make a tweet if you like!</p>
<p><img src="https://cdn.steemitimages.com/DQmeUtmtxvsoPnZiqntQTc8HLa4nGfGs1viShbKWwNGzZ3W/image.png" alt="image.png"></p>
<p><img src="https://cdn.steemitimages.com/DQmZsYpkYR9WAzcd6A9zyW2xnJxi7YCX6TN3VLMTGNRyEmy/image.png" alt="image.png"></p>
<p><img src="https://cdn.steemitimages.com/DQmaDD5ZTDd8DcwxDSbr1qbPFJs1HcbhpS5w4ivjgCEYvmZ/image.png" alt="image.png"></p>
<p><img src="https://cdn.steemitimages.com/DQmXDSwJGimEdkCQi76szNbscLgSW5idAyv9zwHEx9p7XGY/image.png" alt="image.png"></p>
<p>This is how the final recipe looks like:</p>
<p><img src="https://cdn.steemitimages.com/DQmbPn5A7HJZzia8QPNezNNH1AswZTzRk3Wt8znbWy89ixc/image.png" alt="image.png"></p>
<p>Note that we can pass a <em>value1</em> parameter to report the current missing blocks.<br>Here is how you send a notification message to the webhook aka &#x201C;This&#x201D;</p>
<blockquote>
<p>curl -X POST -H &#x201C;Content-Type: application/json&#x201D;  -d &#x2018;{&#x201C;value1&#x201D;:&#x201D;123&#x201D;}&#x2019;  <a href="https://maker.ifttt.com/trigger/{steem-witness}/with/key/YourIFTTTKeyHere" target="_blank" rel="noopener">https://maker.ifttt.com/trigger/{steem-witness}/with/key/YourIFTTTKeyHere</a></p>
</blockquote>
<p>You will see this message on success.<br><strong>Congratulations! You&#x2019;ve fired the steem-witness event</strong></p>
<p>Then, on the github code <a href="https://github.com/DoctorLai/SteemWitnessAutoSwitch/blob/master/monitor-witness.js" target="_blank" rel="noopener">https://github.com/DoctorLai/SteemWitnessAutoSwitch/blob/master/monitor-witness.js</a>  , you can modify a little bit:</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const execSync = require(&apos;child_process&apos;).execSync;</span><br><span class="line"></span><br><span class="line">function reportMissing(missed) {</span><br><span class="line">    log(&quot;Report missing: &quot; + missed);</span><br><span class="line">    // TODO: You can send a email/SMS here</span><br><span class="line">   execSync(&apos;curl -X POST -H &quot;Content-Type: application/json&quot; -d \&apos;{&quot;value1&quot;:&quot;&apos; + missed + &apos;&quot;}\&apos; </span><br><span class="line"> https://maker.ifttt.com/trigger/{steem-witness}/with/key/YourIFTTTKeyHere&apos;);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>That is it, everytime there is a missing block, you will get a call who will tell you total missed blocks aka the parameter <em>value1</em></p>
<p><img src="https://cdn.steemitimages.com/DQmVmc4wjiJ1Hv9d1uyFmxaZe5piMH7dSRtp3GaZqv7jYqY/image.png" alt="image.png"></p>
<p><img src="https://cdn.steemitimages.com/DQmWYGifPn4VcSmPGhWeeaS3weokmJssKu8C3eUPDkrhPno/image.png" alt="image.png"></p>
<p><img src="https://cdn.steemitimages.com/DQmS85JM5C35dVhazMqDYFnEZ9LHfgXXgo79GSqv4cid97n/image.png" alt="image.png"></p>
<hr>

<p>Every little helps! I hope this helps!</p>
<p><strong>Steem On!~</strong></p>
<h2 id="Repost-to-Blog"><a href="#Repost-to-Blog" class="headerlink" title="Repost to Blog"></a><em>Repost to <a href="https://helloacm.com/how-to-set-up-your-on-call-duty-when-your-steem-witness-is-missing-a-block/" target="_blank" rel="noopener">Blog</a></em></h2><p>If you like my work, please consider voting for me, thanks!<br><a href="https://steemit.com/~witnesses" target="_blank" rel="noopener">https://steemit.com/~witnesses</a> type in <strong>justyy</strong> and click <strong><em>VOTE</em></strong><br><img src="https://steemyy.com/images/vote-for-justyy.jpg" alt=""></p>
<p><br><br><strong>Alternatively, you could <a href="https://steemyy.com/witness-voting/?witness=justyy&amp;action=proxy" target="_blank" rel="noopener">proxy to me</a>  if you are too lazy to vote!</strong></p>
<p>Also: you can vote me at the tool I made:  <a href="https://steemyy.com/witness-voting/?witness=justyy" target="_blank" rel="noopener">https://steemyy.com/witness-voting/?witness=justyy</a></p>
<h3 id="Visit-me-at-https-steemyy-com"><a href="#Visit-me-at-https-steemyy-com" class="headerlink" title="Visit me at:  https://steemyy.com"></a>Visit me at:  <a href="https://steemyy.com" target="_blank" rel="noopener">https://steemyy.com</a></h3><hr>
<p>This page is synchronized from the post: <a href="https://steemit.com/@justyy/how-to-set-up-your-on-call-duty-when-your-witness-is-missing-a-block" target="_blank" rel="noopener">&#x2018;How to Set Up Your On-Call Duty when Your Witness is Missing a Block?&#x2019;</a></p>
<script>document.querySelectorAll(".not-gallery-item").forEach(e=>{if(!e.dataset.src)return;const t=document.createElement("img");t.style="display:none !important;",t.src=e.dataset.src,t.addEventListener("error",()=>{t.remove(),e.style.color="inherit",e.style.backgroundImage="none",e.style.background="none"}),t.addEventListener("load",()=>{t.remove()}),document.body.appendChild(t)});</script>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/@justyy/open-source-auto-switch-your-witness-node-in-the-event-of-failure/" class="image is-7by1">
            <img class="thumbnail" src="https://cdn.steemitimages.com/DQmd38mcjMAznHsoSMjDCsnRJmVJALuAtbWRHE1V21tGNJW/image.png" alt="Open Source: Auto Switch Your Witness Node In the Event of Failure">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-06-08T18:28:54.000Z">2020-06-08</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/@justyy/categories/witness-tool/">witness-tool</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 minutes read (About 369 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/@justyy/open-source-auto-switch-your-witness-node-in-the-event-of-failure/">Open Source: Auto Switch Your Witness Node In the Event of Failure</a>
            
        </h1>
        <div class="content">
            <p>My main witness node crashed for no reason when I was asleep around 1.AM midnight. </p>
<p><img src="https://cdn.steemitimages.com/DQmd38mcjMAznHsoSMjDCsnRJmVJALuAtbWRHE1V21tGNJW/image.png" alt="image.png"></p>
<p>Thanks for @fancybrothers who notified me on the discord channel.  When I got the message, it has been 5 hours and I &#x2018;ve missed 310 blocks.</p>
<p>Sh*t happens!</p>
<p>Thus, I decide to write a tool that monitors the witness node, in case of failure, it will detect and switch to your backup node. </p>
<p>Project: <a href="https://github.com/DoctorLai/SteemWitnessAutoSwitch" target="_blank" rel="noopener">https://github.com/DoctorLai/SteemWitnessAutoSwitch</a></p>
<p>It is easy to use: you first need to configure:</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">    &quot;account&quot;: &quot;Your Steem Witness Account&quot;,</span><br><span class="line">    &quot;key&quot;: &quot;Your Active Key&quot;,</span><br><span class="line">    &quot;signing_keys&quot;: [</span><br><span class="line">        &quot;Witness Signing Key 1&quot;,</span><br><span class="line">        &quot;Witness Signing Key 2&quot;,</span><br><span class="line">        &quot;STM1111111111111111111111111111111114T1Anm&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;url&quot;: &quot;https://steemyy.com&quot;,</span><br><span class="line">    &quot;fee&quot;: &quot;3.000 STEEM&quot;,</span><br><span class="line">    &quot;interval&quot;: 60,</span><br><span class="line">    &quot;period&quot;: 360,</span><br><span class="line">    &quot;threshold&quot;: 4  </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>Make the last siging key disabled one so it will disable your node in case all your witness nodes are down.  I have taken out the code to send a email for notification since it is quite customised to my settings but you can easily add it, the easily way to send a email would be to launch the <code>mail</code> utility.</p>
<p><img src="https://cdn.steemitimages.com/DQmRhQtAkAgTHoARkuQLAtAeY5ZmqioDp5dg2W3phTocg2S/image.png" alt="image.png"></p>
<p>The default setting is to switch if there are 4 missed blocks in the last 6 minutes. You can adjust if you are outside TOP 20. The <code>interval</code> is the time interval to check if there are new misses. </p>
<p>Last but not least, I would recommend running this using <code>screen</code> or <code>pm2</code></p>
<hr>

<p>Every little helps! I hope this helps!</p>
<h2 id="Steem-On"><a href="#Steem-On" class="headerlink" title="Steem On!~"></a><strong>Steem On!~</strong></h2><p>If you like my work, please consider voting for me, thanks!<br><a href="https://steemit.com/~witnesses" target="_blank" rel="noopener">https://steemit.com/~witnesses</a> type in <strong>justyy</strong> and click <strong><em>VOTE</em></strong><br><img src="https://steemyy.com/images/vote-for-justyy.jpg" alt=""></p>
<p><br><br><strong>Alternatively, you could <a href="https://steemyy.com/witness-voting/?witness=justyy&amp;action=proxy" target="_blank" rel="noopener">proxy to me</a>  if you are too lazy to vote!</strong></p>
<p>Also: you can vote me at the tool I made:  <a href="https://steemyy.com/witness-voting/?witness=justyy" target="_blank" rel="noopener">https://steemyy.com/witness-voting/?witness=justyy</a></p>
<h3 id="Visit-me-at-https-steemyy-com"><a href="#Visit-me-at-https-steemyy-com" class="headerlink" title="Visit me at:  https://steemyy.com"></a>Visit me at:  <a href="https://steemyy.com" target="_blank" rel="noopener">https://steemyy.com</a></h3><hr>
<p>This page is synchronized from the post: <a href="https://steemit.com/@justyy/open-source-auto-switch-your-witness-node-in-the-event-of-failure" target="_blank" rel="noopener">&#x2018;Open Source: Auto Switch Your Witness Node In the Event of Failure&#x2019;</a></p>
<script>document.querySelectorAll(".not-gallery-item").forEach(e=>{if(!e.dataset.src)return;const t=document.createElement("img");t.style="display:none !important;",t.src=e.dataset.src,t.addEventListener("error",()=>{t.remove(),e.style.color="inherit",e.style.backgroundImage="none",e.style.background="none"}),t.addEventListener("load",()=>{t.remove()}),document.body.appendChild(t)});</script>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/@justyy/are-top-20-witnesses-voting-each-other-introducing-witness-voting-factor/" class="image is-7by1">
            <img class="thumbnail" src="https://steemyy.com/images/vote-for-justyy.jpg" alt="Are Top 20 Witnesses Voting Each Other? Introducing Witness-voting Factor">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-06-07T18:06:42.000Z">2020-06-07</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/@justyy/categories/witness/">witness</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    4 minutes read (About 525 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/@justyy/are-top-20-witnesses-voting-each-other-introducing-witness-voting-factor/">Are Top 20 Witnesses Voting Each Other? Introducing Witness-voting Factor</a>
            
        </h1>
        <div class="content">
            <p>Let&#x2019;s introduce a concept i.e. witness-voting factor that represent the average witness voting each other in the TOP 20. The maximum value is 20, and the minimal is 0.</p>
<p>If the witness-voting factor is 20, it means that all top 20 witnesses are voting each other. This is not healthy as the gap (of votes) between TOP 20 and the rest will be always increasing. Also, since witnesses are voting each other, it is kinda controlled by a group of people who share the same interests - this is centralisation admit it or not.</p>
<h1 id="SteemJs-code-to-compute-the-witness-voting-factor"><a href="#SteemJs-code-to-compute-the-witness-voting-factor" class="headerlink" title="SteemJs code to compute the witness-voting factor"></a>SteemJs code to compute the witness-voting factor</h1><p>The idea is to retrieve the list of the votes of the TOP 20, and group them, count the frequency and sort them. Compute the average. The witness-voting factor for Top 20 on <a href="https://helloacm.com/steemjs-how-many-witnesses-are-running-on-23-1/" target="_blank" rel="noopener">STEEM blockchain</a> is 4.5, compared to 12.65 on HIVE.</p>
<p>Run the following in <a href="https://steemyy.com/steemjs/?s=function%20getTotalWitnesses()%20%7B%0A%20%20%20%20return%20new%20Promise((resolve%2C%20reject)%20%3D%3E%20%7B%0A%20%20%20%20%20%20steem.api.getWitnessCount(function(err%2C%20result)%20%7B%0A%20%20%20%20%20%20%20%20%20%20if%20(!err)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve(result)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20reject(err)%3B%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D)%3B%0A%7D%0A%0Afunction%20getAllWitnessAccounts(total)%20%7B%0A%20%20%20%20return%20new%20Promise((resolve%2C%20reject)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20steem.api.getWitnesses(%5B...Array(total).keys()%5D%2C%20function(err%2C%20result)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!err)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve(result)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reject(err)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D)%3B%0A%7D%20%20%20%0A%0Afunction%20getAccounts(accounts)%20%7B%0A%20%20%20%20return%20new%20Promise((resolve%2C%20reject)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20steem.api.getAccounts(accounts%2C%20function(err%2C%20result)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!err)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve(result)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reject(err)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%7D)%3B%0A%7D%20%20%20%0A%0A%0A(async%20function%20()%20%7B%0A%20%20%20%20const%20totalWitnesses%20%3D%20await%20getTotalWitnesses()%3B%0A%20%20%20%20let%20data%20%3D%20await%20getAllWitnessAccounts(totalWitnesses)%3B%0A%20%20%20%20data%20%3D%20data.filter(x%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20return%20(x.votes%20%3E%200)%20%26%26%20(x.running_version%20%3D%3D%3D%20%220.23.1%22)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%20%20data.sort((a%2C%20b)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20return%20b.votes%20-%20a.votes%3B%0A%20%20%20%20%7D)%3B%0A%20%20%20%20data%20%3D%20data.slice(0%2C%2020)%3B%0A%20%20%20%20let%20top%20%3D%20%5B%5D%3B%0A%20%20%20%20data.map((x)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20top.push(x.owner)%3B%0A%20%20%20%20%7D)%3B%0A%20%20%20%20const%20accountData%20%3D%20await%20getAccounts(top)%3B%0A%20%20%20%20let%20votes%20%3D%20%7B%7D%3B%0A%20%20%20%20data.map((x)%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20const%20account%20%3D%20accountData.filter(v%20%3D%3E%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20v.name%20%3D%3D%3D%20x.owner%0A%20%20%20%20%20%20%20%20%7D)%3B%0A%20%20%20%20%20%20%20%20for%20(let%20w%20of%20account%5B0%5D.witness_votes)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(typeof%20votes%5Bw%5D%20%3D%3D%3D%20%22undefined%22)%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20votes%5Bw%5D%20%3D%201%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20votes%5Bw%5D%20%2B%2B%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D)%3B%0A%20%20%20%20%0A%20%20%20%20%0A%20%20%20%20var%20items%20%3D%20Object.keys(votes).map(function(key)%20%7B%0A%20%20%20%20%20%20return%20%5Bkey%2C%20votes%5Bkey%5D%5D%3B%0A%20%20%20%20%7D)%3B%0A%20%20%20%20%0A%20%20%20%20items.sort(function(first%2C%20second)%20%7B%0A%20%20%20%20%20%20return%20second%5B1%5D%20-%20first%5B1%5D%3B%0A%20%20%20%20%7D)%3B%0A%20%20%20%20%0A%20%20%20%20let%20x%20%3D%200%2C%20cnt%20%3D%200%3B%0A%20%20%20%20for%20(let%20w%20of%20items)%20%7B%0A%20%20%20%20%20%20%20%20if%20(top.includes(w%5B0%5D))%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20log(w%5B0%5D%20%2B%20%22%2C%20%22%20%2B%20w%5B1%5D)%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20x%20%2B%3D%20w%5B1%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20cnt%20%2B%2B%3B%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20log(x%2Fcnt)%3B%0A%7D)()%3B%0A%0A" target="_blank" rel="noopener">SteemJs Editor</a></p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">function getTotalWitnesses() {</span><br><span class="line">    return new Promise((resolve, reject) =&gt; {</span><br><span class="line">      steem.api.getWitnessCount(function(err, result) {</span><br><span class="line">          if (!err) {</span><br><span class="line">              resolve(result);</span><br><span class="line">          } else {</span><br><span class="line">              reject(err);</span><br><span class="line">          }</span><br><span class="line">      });</span><br><span class="line">    });</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function getAllWitnessAccounts(total) {</span><br><span class="line">    return new Promise((resolve, reject) =&gt; {</span><br><span class="line">          steem.api.getWitnesses([...Array(total).keys()], function(err, result) {</span><br><span class="line">            if (!err) {</span><br><span class="line">                resolve(result);</span><br><span class="line">            } else {</span><br><span class="line">                reject(err);</span><br><span class="line">           }</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}   </span><br><span class="line"></span><br><span class="line">function getAccounts(accounts) {</span><br><span class="line">    return new Promise((resolve, reject) =&gt; {</span><br><span class="line">          steem.api.getAccounts(accounts, function(err, result) {</span><br><span class="line">            if (!err) {</span><br><span class="line">                resolve(result);</span><br><span class="line">            } else {</span><br><span class="line">                reject(err);</span><br><span class="line">           }</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}   </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">(async function () {</span><br><span class="line">    const totalWitnesses = await getTotalWitnesses();</span><br><span class="line">    let data = await getAllWitnessAccounts(totalWitnesses);</span><br><span class="line">    data = data.filter(x =&gt; {</span><br><span class="line">        // reduce the noise</span><br><span class="line">        return (x.votes &gt; 0) &amp;&amp; (x.running_version === &quot;0.23.1&quot;);</span><br><span class="line">    });</span><br><span class="line">    // sort by votes</span><br><span class="line">    data.sort((a, b) =&gt; {</span><br><span class="line">        return b.votes - a.votes;</span><br><span class="line">    });</span><br><span class="line">    // only count TOP 20 witnesses</span><br><span class="line">    data = data.slice(0, 20);</span><br><span class="line">    let top = [];</span><br><span class="line">    data.map((x) =&gt; {</span><br><span class="line">        top.push(x.owner);</span><br><span class="line">    });</span><br><span class="line">    const accountData = await getAccounts(top);</span><br><span class="line">    let votes = {};</span><br><span class="line">    data.map((x) =&gt; {</span><br><span class="line">        const account = accountData.filter(v =&gt; {</span><br><span class="line">            return v.name === x.owner</span><br><span class="line">        });</span><br><span class="line">        // count the vote frequency for each witness</span><br><span class="line">        for (let w of account[0].witness_votes) {</span><br><span class="line">            if (typeof votes[w] === &quot;undefined&quot;) {</span><br><span class="line">                votes[w] = 1;</span><br><span class="line">            } else {</span><br><span class="line">                votes[w] ++;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    });    </span><br><span class="line">    </span><br><span class="line">    var items = Object.keys(votes).map(function(key) {</span><br><span class="line">      return [key, votes[key]];</span><br><span class="line">    });</span><br><span class="line">    </span><br><span class="line">    items.sort(function(first, second) {</span><br><span class="line">      return second[1] - first[1];</span><br><span class="line">    });</span><br><span class="line">    </span><br><span class="line">    let x = 0, cnt = 0;</span><br><span class="line">    for (let w of items) {</span><br><span class="line">        // TOP 20 witnesses only</span><br><span class="line">        if (top.includes(w[0])) {</span><br><span class="line">            log(w[0] + &quot;, &quot; + w[1]);</span><br><span class="line">            x += w[1];</span><br><span class="line">            cnt ++;</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    log(x/cnt);</span><br><span class="line">})();</span><br></pre></td></tr></tbody></table></figure>
<p>Here is the detail list:<br></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">future.witness, 7</span><br><span class="line">justyy, 7</span><br><span class="line">steem-agora, 7</span><br><span class="line">steemchiller, 7</span><br><span class="line">dev.supporters, 6</span><br><span class="line">dlike, 6</span><br><span class="line">maiyude, 6</span><br><span class="line">steem-supporter, 6</span><br><span class="line">symbionts, 6</span><br><span class="line">steem-dragon, 4</span><br><span class="line">scissor.sisters, 4</span><br><span class="line">cryptoking777, 3</span><br><span class="line">hivei0, 3</span><br><span class="line">hoasen, 3</span><br><span class="line">juddsmith079, 3</span><br><span class="line">matreshka, 3</span><br><span class="line">protoss20, 3</span><br><span class="line">hinomaru-jp, 2</span><br><span class="line">inwi, 2</span><br><span class="line">rnt1, 2</span><br></pre></td></tr></tbody></table></figure><p></p>
<hr>

<p>Every little helps! I hope this helps!</p>
<p><strong>Steem On!~</strong></p>
<h2 id="Reposted-to-Blog"><a href="#Reposted-to-Blog" class="headerlink" title="Reposted to Blog"></a><em>Reposted to <a href="https://helloacm.com/are-top-20-witnesses-voting-each-other-introducing-witness-voting-factor/" target="_blank" rel="noopener">Blog</a></em></h2><p>If you like my work, please consider voting for me, thanks!<br><a href="https://steemit.com/~witnesses" target="_blank" rel="noopener">https://steemit.com/~witnesses</a> type in <strong>justyy</strong> and click <strong><em>VOTE</em></strong><br><img src="https://steemyy.com/images/vote-for-justyy.jpg" alt=""></p>
<p><br><br><strong>Alternatively, you could <a href="https://steemyy.com/witness-voting/?witness=justyy&amp;action=proxy" target="_blank" rel="noopener">proxy to me</a>  if you are too lazy to vote!</strong></p>
<p>Also: you can vote me at the tool I made:  <a href="https://steemyy.com/witness-voting/?witness=justyy" target="_blank" rel="noopener">https://steemyy.com/witness-voting/?witness=justyy</a></p>
<h3 id="Visit-me-at-https-steemyy-com"><a href="#Visit-me-at-https-steemyy-com" class="headerlink" title="Visit me at:  https://steemyy.com"></a>Visit me at:  <a href="https://steemyy.com" target="_blank" rel="noopener">https://steemyy.com</a></h3><hr>
<p>This page is synchronized from the post: <a href="https://steemit.com/@justyy/are-top-20-witnesses-voting-each-other-introducing-witness-voting-factor" target="_blank" rel="noopener">&#x2018;Are Top 20 Witnesses Voting Each Other? Introducing Witness-voting Factor&#x2019;</a></p>
<script>document.querySelectorAll(".not-gallery-item").forEach(e=>{if(!e.dataset.src)return;const t=document.createElement("img");t.style="display:none !important;",t.src=e.dataset.src,t.addEventListener("error",()=>{t.remove(),e.style.color="inherit",e.style.backgroundImage="none",e.style.background="none"}),t.addEventListener("load",()=>{t.remove()}),document.body.appendChild(t)});</script>
        </div>
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-image">
        <a href="/@justyy/steemjs-how-many-witnesses-are-running-on-23-1/" class="image is-7by1">
            <img class="thumbnail" src="https://cdn.steemitimages.com/DQmZcg5iThqQD4uUQwFsxtRBGm8DPxFP5q7ziRca1XJ9hnM/image.png" alt="SteemJs: How Many Witnesses are Running on 23.1?">
        </a>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2020-06-06T18:52:03.000Z">2020-06-06</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/@justyy/categories/steemjs/">steemjs</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    3 minutes read (About 429 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/@justyy/steemjs-how-many-witnesses-are-running-on-23-1/">SteemJs: How Many Witnesses are Running on 23.1?</a>
            
        </h1>
        <div class="content">
            <p>How many <a href="https://steemyy.com/witness-ranking/" target="_blank" rel="noopener">witnesses</a> are running on 23.1 and how many of them are active? It turns out answering this question does not require preprocess blocks on steem blockchain e.g. SteemSQL. Rather, we can get the answer by pure SteemJS.</p>
<h1 id="Get-All-Witnesses"><a href="#Get-All-Witnesses" class="headerlink" title="Get All Witnesses"></a>Get All Witnesses</h1><p>First, we can use the <code>steemp.api.getWitnessCount</code> to return the list of all registered witnesses - which is a lot more than we thought, currently more than 1400 witnesses but of course many of them have been disabled or never produced a block.</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function getTotalWitnesses() {</span><br><span class="line">    return new Promise((resolve, reject) =&gt; {</span><br><span class="line">      steem.api.getWitnessCount(function(err, result) {</span><br><span class="line">          if (!err) {</span><br><span class="line">              resolve(result);</span><br><span class="line">          } else {</span><br><span class="line">              reject(err);</span><br><span class="line">          }</span><br><span class="line">      });</span><br><span class="line">    });</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h1 id="Get-All-Witnesses-Accounts"><a href="#Get-All-Witnesses-Accounts" class="headerlink" title="Get All Witnesses Accounts"></a>Get All Witnesses Accounts</h1><p>Then, we can use <code>steem.api.getWitnesses</code> to retreive the witnesses information for multiple accounts at the same time. </p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function getAllWitnessAccounts(total) {</span><br><span class="line">    return new Promise((resolve, reject) =&gt; {</span><br><span class="line">          steem.api.getWitnesses([...Array(total).keys()], function(err, result) {</span><br><span class="line">            if (!err) {</span><br><span class="line">                resolve(result);</span><br><span class="line">            } else {</span><br><span class="line">                reject(err);</span><br><span class="line">           }</span><br><span class="line">        });</span><br><span class="line">    });</span><br><span class="line">}   </span><br><span class="line">`</span><br></pre></td></tr></tbody></table></figure>
<h1 id="Filtering"><a href="#Filtering" class="headerlink" title="Filtering"></a>Filtering</h1><p>Then, we can chain those two functions to filter out those witnesses that are running 23.1 and are active.</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(async function () {</span><br><span class="line">    const totalWitnesses = await getTotalWitnesses();</span><br><span class="line">    let data = await getAllWitnessAccounts(totalWitnesses);</span><br><span class="line">    log(data.filter(x =&gt; {</span><br><span class="line">        return x.running_version === &quot;0.23.1&quot; &amp;&amp; (x.signing_key !== &quot;STM1111111111111111111111111111111114T1Anm&quot;);</span><br><span class="line">    }).length);</span><br><span class="line">})();</span><br></pre></td></tr></tbody></table></figure>
<h3 id="The-answer-is-46-witnesses-are-running-on-23-1-and-all-of-them-are-active"><a href="#The-answer-is-46-witnesses-are-running-on-23-1-and-all-of-them-are-active" class="headerlink" title="The answer is 46 witnesses are running on 23.1 and all of them are active."></a>The answer is 46 witnesses are running on 23.1 and all of them are active.</h3><p>If we point the RPC node to HIVE chain, we get 107 witnesses running on 23.0.</p>
<p>Run the code using <a href="https://steemyy.com/steemjs/?s=function%20getTotalWitnesses()%20%7B%0D%0A%20%20%20%20return%20new%20Promise((resolve%2C%20reject)%20%3D%3E%20%7B%0D%0A%20%20%20%20%20%20steem.api.getWitnessCount(function(err%2C%20result)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20if%20(!err)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve(result)%3B%0D%0A%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20reject(err)%3B%0D%0A%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%7D)%3B%0D%0A%20%20%20%20%7D)%3B%0D%0A%7D%0D%0A%0D%0Afunction%20getAllWitnessAccounts(total)%20%7B%0D%0A%20%20%20%20return%20new%20Promise((resolve%2C%20reject)%20%3D%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20steem.api.getWitnesses(%5B...Array(total).keys()%5D%2C%20function(err%2C%20result)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20(!err)%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20resolve(result)%3B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20else%20%7B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20reject(err)%3B%0D%0A%20%20%20%20%20%20%20%20%20%20%20%7D%0D%0A%20%20%20%20%20%20%20%20%7D)%3B%0D%0A%20%20%20%20%7D)%3B%0D%0A%7D%20%20%20%0D%0A%0D%0A(async%20function%20()%20%7B%0D%0A%20%20%20%20const%20totalWitnesses%20%3D%20await%20getTotalWitnesses()%3B%0D%0A%20%20%20%20let%20data%20%3D%20await%20getAllWitnessAccounts(totalWitnesses)%3B%0D%0A%20%20%20%20log(data.filter(x%20%3D%3E%20%7B%0D%0A%20%20%20%20%20%20%20%20return%20x.running_version%20%3D%3D%3D%20%220.23.1%22%20%26%26%20(x.signing_key%20!%3D%3D%20%22STM1111111111111111111111111111111114T1Anm%22)%3B%0D%0A%20%20%20%20%7D).length)%3B%0D%0A%7D)()%3B%0D%0A" target="_blank" rel="noopener">SteemJs</a></p>
<p>Slightly changing the query, we know:<br>There are 24 Witnesses running at 0.23.0 but they are disabled.<br>And there are 9 witnesses running at 0.23.0 and they are &#x2018;active&#x2019; which may be those HIVE witnesses who didn&#x2019;t take offline they witnesses.</p>
<p>BTW, i have added the dSteem into the SteemJs tool:  <a href="https://steemyy.com/steemjs/" target="_blank" rel="noopener">https://steemyy.com/steemjs/</a><br><img src="https://cdn.steemitimages.com/DQmZcg5iThqQD4uUQwFsxtRBGm8DPxFP5q7ziRca1XJ9hnM/image.png" alt="image.png"></p>
<hr>

<p>Every little helps! I hope this helps!</p>
<p><strong>Steem On!~</strong></p>
<h2 id="Reposted-to-Blog"><a href="#Reposted-to-Blog" class="headerlink" title="Reposted to Blog"></a><em>Reposted to <a href="https://helloacm.com/steemjs-how-many-witnesses-are-running-on-23-1/" target="_blank" rel="noopener">Blog</a></em></h2><p>If you like my work, please consider voting for me, thanks!<br><a href="https://steemit.com/~witnesses" target="_blank" rel="noopener">https://steemit.com/~witnesses</a> type in <strong>justyy</strong> and click <strong><em>VOTE</em></strong><br><img src="https://steemyy.com/images/vote-for-justyy.jpg" alt=""></p>
<p><br><br><strong>Alternatively, you could <a href="https://steemyy.com/witness-voting/?witness=justyy&amp;action=proxy" target="_blank" rel="noopener">proxy to me</a>  if you are too lazy to vote!</strong></p>
<p>Also: you can vote me at the tool I made:  <a href="https://steemyy.com/witness-voting/?witness=justyy" target="_blank" rel="noopener">https://steemyy.com/witness-voting/?witness=justyy</a></p>
<h3 id="Visit-me-at-https-steemyy-com"><a href="#Visit-me-at-https-steemyy-com" class="headerlink" title="Visit me at:  https://steemyy.com"></a>Visit me at:  <a href="https://steemyy.com" target="_blank" rel="noopener">https://steemyy.com</a></h3><hr>
<p>This page is synchronized from the post: <a href="https://steemit.com/@justyy/steemjs-how-many-witnesses-are-running-on-23-1" target="_blank" rel="noopener">&#x2018;SteemJs: How Many Witnesses are Running on 23.1?&#x2019;</a></p>
<script>document.querySelectorAll(".not-gallery-item").forEach(e=>{if(!e.dataset.src)return;const t=document.createElement("img");t.style="display:none !important;",t.src=e.dataset.src,t.addEventListener("error",()=>{t.remove(),e.style.color="inherit",e.style.backgroundImage="none",e.style.background="none"}),t.addEventListener("load",()=>{t.remove()}),document.body.appendChild(t)});</script>
        </div>
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous">
            <a class="is-flex-grow has-text-black-ter" href="/@justyy/page/3/">Anterior</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/@justyy/page/5/">Siguiente</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link has-text-black-ter" href="/@justyy/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/@justyy/page/2/">2</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/@justyy/page/3/">3</a></li>
            
            <li><a class="pagination-link is-current" href="/@justyy/page/4/">4</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/@justyy/page/5/">5</a></li>
            
            <li><span class="pagination-ellipsis has-text-black-ter">&hellip;</span></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/@justyy/page/290/">290</a></li>
            
        </ul>
    </nav>
</div>
</div>
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/@justyy/">
                
                    <img src="https://avatars0.githubusercontent.com/u/50857551?s=200&v=4" alt="justyy" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2020 justyy&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en_US.UTF-8");</script>


    
    
    
    <script src="/@justyy/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>document.addEventListener("DOMContentLoaded",function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})});</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>document.addEventListener("DOMContentLoaded",function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!1},SVG:{matchFontHeight:!1},CommonHTML:{matchFontHeight:!1},tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})});</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>



    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    
    

    
    
    





    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Entradas",PAGES:"Pages",CATEGORIES:"Categorias",TAGS:"Etiquetas",UNTITLED:"(Untitled)"},CONTENT_URL:"/@justyy/content.json"};</script>



    
<script src="/@justyy/js/bundle.js" defer></script></body>
</html>

