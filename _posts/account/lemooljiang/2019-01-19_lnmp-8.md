
---
title: "LNMP环境自定义安装（二） / 网络研习社#8"
permlink: lnmp-8
catalog: true
toc_nav_num: true
toc: true
date: 2019-01-19 11:26:15
categories:
- cn
tags:
- cn
- network-institute
- lnmp
- nginx
- mysql
thumbnail: https://steemitimages.com/640x0/https://cdn.steemitimages.com/DQmQ5crWTmidtivpsJRX3BcUmeQ6j4LC34P1ti58umzz1Dh/lnmp.jpg
sidebar:
    right:
        sticky: true
widgets:
    -
        type: toc
        position: right
---


![](https://steemitimages.com/640x0/https://cdn.steemitimages.com/DQmQ5crWTmidtivpsJRX3BcUmeQ6j4LC34P1ti58umzz1Dh/lnmp.jpg)

第二方法就是自定义安装了，每个软件都走一遍。这个就有点折腾了，需要点时间啰。开始吧（centos 6.7）。

### 1、Nginx编译安装：
```
#安装pcre
yum install pcre pcre-devel –y
#检查安装
rpm -qa pcre pcre-devel
rpm -qa openssl-devel openssl
#安装openssl-devel
yum install –y openssl openssl-devel

#安装Nginx（编译安装）
mkdir -p /home/jiangzhibin/tools
cd /home/jiangzhibin/tools
wget –q http://nginx.org/download/nginx-1.14.2.tar.gz
ls -l nginx-1.14.2.tar.gz
useradd nginx -s /sbin/nologin –M
tar xf nginx-1.14.2.tar.gz
cd nginx-1.14.2
./configure --user=nginx --group=nginx --prefix=/application/nginx-1.14.2/ --with-http_stub_status_module --with-http_ssl_module
make
make install
#创建软链接
ln -s /application/nginx-1.14.2 /application/nginx
#检查链接和目录
ll /application | grep nginx
ls -l /application/nginx
#检查配置文件
/application/nginx/sbin/nginx –t
#吂动nginx并查看
/application/nginx/sbin/nginx
lsof -i :80
wget 127.0.0.1
#在window中查看nginx服务
http://192.168.1.101/
#默认的启动文件位置
cd /application/nginx/html

#检查配置文件
/application/nginx/sbin/nginx -t
#平滑重载
/application/nginx/sbin/nginx -s reload


# /application/nginx/conf/nginx.conf设置
    server {
        listen       80;
        server_name  localhost;   
        location / {
            root   html;
            index  index.html index.htm;
        }

```
<br/>

### 2、MySQL安装(二进制安装)

```
#创建mysql用户及组
groupadd mysql
useradd -s /sbin/nologin -g mysql -M mysql
id mysql
cd /application/mysql
chown -R mysql .
chgrp -R mysql .
chown -R mysql /application/mysql/data
#下载安装文件再上传：https://dev.mysql.com/downloads/mysql
cd /home/jiangzhibin/tools
直接下载安装包，再上传至linux -> rz
yum install lrzsz –y
rz 
tar xf mysql-5.7.24-linux-glibc2.12-x86_64.tar.gz
mv mysql-5.7.24-linux-glibc2.12-x86_64 /application/mysql-5.7.24
ln -s /application/mysql-5.7.24/ /application/mysql
#配置参数
bin/mysqld --initialize --user=mysql --basedir=/application/mysql --datadir=/application/mysql/data
 
此处需要注意记录生成的临时密码，如上文结尾处的：Yh85uype;YP
bin/mysql_ssl_rsa_setup  --datadir=/application/mysql/data
#修改系统配置文件
cd /application/mysql /support-files
cp mysql.server /etc/init.d/mysql
#修改以下内容：
vim /etc/init.d/mysql
basedir = /application/mysql
datadir = /application/mysql/data
#启动mysql
 /etc/init.d/mysql start
mysql -hlocalhost -uroot -p

#修改默认密码
set password=password('314159');

```

<br/>

### 3、FastCGI

```
安装PHP所需lib库
cd /home/jiangzhibin/tools
yum install zlib-devel libxml2-devel libjpeg-devel libiconv-devel freetype-devel libpng-devel gd-devel curl-devel libxslt-devel –y
安装的libiconv库
wget http://ftp.gnu.org/pub/gnu/libiconv/libiconv-1.14.tar.gz
tar zxf libiconv-1.14.tar.gz
cd libiconv-1.14
./configure --prefix=/usr/local/libiconv
make && make install
安装libmcrypt库
cd ..
wget http://sourceforge.net/projects/mcrypt/files/Libmcrypt/2.5.8/libmcrypt-2.5.8.tar.gz
tar zxf libmcrypt-2.5.8.tar.gz
cd libmcrypt-2.5.8
./configure
make && make install
安装mhash加密扩展库
yum install mhash mhash-devel –y
rpm -qa mhash mhash-devel
安装mcrypt加密扩展库
yum install mcrypt –y
rpm -qa mcrypt


```

<br/>

### 4、PHP5.6编译安装

```
#检查mysql nginx 的安装和运行情况
ls –ld /application/mysql
ls –ld /application/nginx
netstat -lntup|grep -E "80|3306"
#先创建php需要安装的目录
cd /etc/
mkdir php
cd /usr/local/
mkdir php
#下载php并上传至当前目录（ /usr/local/）
tar xzf php-5.6.40.tar.gz
cd php-5.6.40
./configure --prefix=/usr/local/php --with-config-file-path=/etc/php --enable-fpm --enable-pcntl --enable-mysqlnd --enable-opcache --enable-sockets --enable-sysvmsg --enable-sysvsem  --enable-sysvshm --enable-shmop --enable-zip --enable-ftp --enable-soap --enable-xml --enable-mbstring --disable-rpath --disable-debug --disable-fileinfo --with-mysql=mysqlnd --with-mysqli=mysqlnd --with-pdo-mysql=mysqlnd --with-pcre-regex --with-iconv --with-zlib --with-gd --with-openssl --with-mhash --with-xmlrpc --with-curl --with-imap-ssl

make
make install
 ls /usr/local/php
php –v

#拷贝配置文件模板到配置文件目录中
cp php.ini-development /etc/php/php.ini
#创建软连接
ln -s /usr/local/php/bin/php /usr/bin/php
ln -s /usr/local/php/bin/phpize /usr/bin/phpize
ln -s /usr/local/php/sbin/php-fpm /usr/bin/php-fpm

cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf
ln -s /usr/local/php/etc/php-fpm.conf /etc/php/php-fpm.conf

vim /usr/local/php/etc/php-fpm.conf
pid = run/php-fpm.pid #取消前面的分号

cp /usr/local/php-5.6.40/sapi/fpm //init.d.php-fpm /etc/rc.d/init.d/php-fpm  #拷贝php-fpm到启动目录
chmod +x /etc/rc.d/init.d/php-fpm #添加执行权限
chkconfig php-fpm on #设置开机启动
启动服务
cd /etc/rc.d/init.d/
./php-fpm start
netstat -tunlp |grep 9000
ps -ef|grep fpm

#nginx配置解析php
cd /application/nginx/conf
vim nginx.conf
在 server 下找到
location / {
    root html;
    index index.html index.htm index.php;    #加上index.php，让nginx服务器默认支持index.php为首页
}
往下面配置.php请求被传送到后端的php-fpm模块，默认情况下php配置块是被注释的，此时去掉注释并修改为以下内容：
       location ~ \.php$ {
            root  html;   
            fastcgi_pass 127.0.0.1:9000;
            fastcgi_index index.php;
       fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;   #这里原来是/scripts，需要改成$document_root
            include fastcgi_params;
        }    

```
<br/>
过程虽然有点曲折，但收获满满！只有努力过坑的人，以后才不会畏惧各种坑！

- - -

This page is synchronized from the post: [LNMP环境自定义安装（二） / 网络研习社#8](https://steemit.com/@lemooljiang/lnmp-8)
