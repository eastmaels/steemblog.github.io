
---
title: '升级本地节点到EOS 1.8.0'
permlink: 4bxhck-eos-1-8-0
catalog: true
toc_nav_num: true
toc: true
position: 9999
date: 2019-07-01 02:06:15
categories:
- cn
tags:
- cn
- eos
- nodeos
- study
- sct
thumbnail: 'https://steemitimages.com/DQmRkLq6rRew3mHfx4vYGWyqpC8wSebLPeC2iZCXAdpuGkR/image.png'
sidebar:
    right:
        sticky: true
widgets:
    -
        type: toc
        position: right
---


昨天的帖子提到[编译了 EOS 1.8.0](https://steemit.com/cn/@oflyhigh/eos-1-8-0)，但是单单编译可还不够，还要将之前运行的v1.7.4版本的节点升级到v1.8.0才行。

![](https://steemitimages.com/DQmRkLq6rRew3mHfx4vYGWyqpC8wSebLPeC2iZCXAdpuGkR/image.png)
(图源 ：[pixabay](https://pixabay.com/))

不过因为这次是共识升级(硬分叉)版本，所以以往的直接替换是行不通的啦。

# 删除bnet plugin设置

首先我们要删除之前bnet相关设置，因为在v1.8.0中bnet已经彻底不被支持啦。

如果没有删除相关设置，运行v1.8.0版本的话，就会出现类似如下`unrecognised option`错误：

>error 2019-06-30T01:39:04.740 nodeos    main.cpp:120                  main                 ] Throw location unknown (consider using BOOST_THROW_EXCEPTION)
Dynamic exception type: boost::wrapexcept<boost::program_options::unknown_option>
std::exception::what: unrecognised option 'bnet-follow-irreversible'

# 删除相关目录

因为是共识协议升级，所以新版本的chainbase和之前版本chainbase是不兼容的，在运行新版本之前需要删除`data目录下`的如下内容：
* blocks/reversible directory
* state-history directory
* state directory

如果没有删除上述目录就开始运行v1.8.0，那么就会出现如下错误：
>N5boost10wrapexceptISt13runtime_errorEE: chainbase database format not compatible with this version of chainbase.

![](https://cdn.steemitimages.com/DQmdc9fqsRfqLMcAxQX9h6AUreJQhQo7kKF3fuJP71td6sV/image.png)

# Replay

当做完上述工作后，再次重启v1.8.0的nodeos，系统会自动进行replay。

![](https://cdn.steemitimages.com/DQmUM5N6Ju2W1R5kaWdFyFWyg8EtRfosj4hswyGgvZ4jLc7/image.png)

不过看起来，replay是一个漫长的工作，我这跑了约12个小时，才将将完成1/4，目测全部完成，需要2天以上。

# 升级指南中的步骤

把升级指南中的步骤附一份，供大家参考。

>* Ensure that their existing node is running the most recent stable release (1.7) of nodeos and then shut down nodeos.
>
>* Make a backup and delete the blocks/reversible directory, state-history directory, and state directory within the data directory.
>
>* Replace their old version of nodeos with the new release.
>
>* Start the new 1.8 release of nodeos and let it complete replay from genesis and catch up with syncing with the network. The node should receive blocks and LIB should advance. Nodes running v1.8 and v1.7 will continue to coexist in the same network prior to the activation of the first protocol upgrade feature.

# 相关链接

* [编译 EOS 1.8.0](https://steemit.com/cn/@oflyhigh/eos-1-8-0)
* [EOSIO v1.8.0 Release Notes](https://github.com/EOSIO/eos/releases/tag/v1.8.0)
* [Consensus Protocol Upgrade Process #7237](https://github.com/EOSIO/eos/issues/7237)
* [1.8: Consensus Protocol Upgrade Process](https://developers.eos.io/eosio-nodeos/docs/consensus-protocol-upgrade-process)

----
<center><strong>Vote For Me As Witness</strong>
https://steemit.com/~witnesses type in **`oflyhigh`** and click ***`VOTE`***
[![](https://cdn.steemitimages.com/DQmX5NysqT44FBa3bhuWqQ69nAbseu8Nt5YQPn2pYejPVxA/image.png)](https://steemit.com/~witnesses)
[Vote @oflyhigh via Steemconnect](https://steemconnect.com/sign/account-witness-vote?witness=oflyhigh&approve=1)
<strong>Thank you!</strong></center>

- - -

This page is synchronized from the post: ['升级本地节点到EOS 1.8.0'](https://steemit.com/@oflyhigh/4bxhck-eos-1-8-0)
