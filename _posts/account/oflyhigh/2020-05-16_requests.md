
---
title: 'æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼šrequests è¯»å–ç½‘ç»œå›¾ç‰‡'
permlink: requests
catalog: true
toc_nav_num: true
toc: true
position: 9999
date: 2020-05-16 14:40:36
categories:
- cn
tags:
- cn
- cutehive
- cn-programming
- python
- requests
thumbnail: 'https://cdn.pixabay.com/photo/2018/08/14/13/23/ocean-3605547_960_720.jpg'
sidebar:
    right:
        sticky: true
widgets:
    -
        type: toc
        position: right
---


å¸®åˆ«äººå†™ä¸€ä¸ªå°è„šæœ¬ï¼Œå…¶ä¸­éœ€è¦è¯»å–ç½‘ç»œä¸Šçš„ä¸€äº›å›¾ç‰‡èµ„æºã€‚è¯è¯´ä»¥å‰å€’æ˜¯ç”¨è¿‡Python çš„requests å¯¹æŒ‡å®šç½‘å€è¿›è¡Œè¿‡POSTå’ŒGETæ“ä½œï¼Œæƒ³å¿…è¯»å–å›¾ç‰‡åº”è¯¥ç”¨GETæ“ä½œå°±å¯ä»¥äº†å§ã€‚

ä¸ºäº†è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘é¦–å…ˆé€‰æ‹©äº†ä¸€ä¸ªå›¾ï¼Œè™½ç„¶åªæ˜¯è¯»ä¸€ä¸ªå›¾ç‰‡ï¼Œä½†æ˜¯æˆ‘ä»¬çš„å¾é€”æ˜¯æ˜Ÿè¾°å¤§æµ·ã€‚ï¼š
![](https://cdn.pixabay.com/photo/2018/08/14/13/23/ocean-3605547_960_720.jpg)

è¿™å›¾çš„åœ°å€æ˜¯ï¼š
>`https://cdn.pixabay.com/photo/2018/08/14/13/23/ocean-3605547_960_720.jpg`

ç„¶è€Œæˆ‘å°è¯•ç›´æ¥ä¿å­˜ï¼Œå´ä¿å­˜æˆä¸ºäº†`ocean-3605547_960_720.webp`ï¼Œç¬¬ä¸€æ¬¡è§åˆ°è¿™ä¸ªwebpæ ¼å¼ï¼ŒæŸ¥äº†ä¸€ä¸‹ï¼š
>WebPæ˜¯Googleæ–°æ¨å‡ºçš„å½±åƒæŠ€æœ¯ï¼Œå®ƒå¯è®©ç½‘é¡µå›¾æ¡£æœ‰æ•ˆè¿›è¡Œå‹ç¼©ï¼ŒåŒæ—¶åˆä¸å½±å“å›¾ç‰‡æ ¼å¼å…¼å®¹ä¸å®é™…æ¸…æ™°åº¦ï¼Œè¿›è€Œè®©æ•´ä½“ç½‘é¡µä¸‹è½½é€Ÿåº¦åŠ å¿«ã€‚

# ç›´æ¥ä¿å­˜

ä¸ç®¡äº†ï¼Œæˆ‘å°±æŒ‰JPEGæ ¼å¼æ¥ä¿å­˜è¯•è¯•å§ï¼Œäºæ˜¯å†™äº†å¦‚ä¸‹ä»£ç ï¼š

```
url = "https://cdn.pixabay.com/photo/2018/08/14/13/23/ocean-3605547_960_720.jpg"
r = requests.get(url)

print(len(r.content))
with open('image.jpg', 'wb') as fd:
        fd.write(r.content)
        fd.close()
```

è¿è¡Œåï¼Œæ˜¾ç¤ºå‡ºçš„`r.content`çš„é•¿åº¦ä¸ºï¼š`81621`ï¼Œçœ‹ä¸€ä¸‹ç”Ÿæˆçš„å›¾åƒï¼š
>![image.png](https://images.hive.blog/DQmSC37N5fNx3riNt4QqAerch7RsjuS6ByQMAMdSC7fbf7W/image.png)

æ‰“å¼€åä¹Ÿæ­£å¸¸æ˜¾ç¤ºï¼Œè¯´æ˜è¿™æ ·è¯»å–/ä¿å­˜è¿˜æ˜¯æ²¡æœ‰æ²¡é—®é¢˜çš„ã€‚

# æµå½¢å¼ä¿å­˜

å°½ç®¡ä¸Šè¿°æ–¹æ³•å¯ä»¥ç›´æ¥ä¿å­˜å›¾åƒï¼Œä¸è¿‡æˆ‘æŸ¥ç½‘ä¸Šå¥½å¤šèµ„æ–™éƒ½æ˜¯å»ºè®®ç”¨iter_content()æ–¹æ³•å¾ªç¯è·å–æ–‡ä»¶æµä¿¡æ¯ã€‚

ç›´æ¥ä¸Šä»£ç ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯requests.getä¸­è®¾ç½®`stream=True`

```
url = "https://cdn.pixabay.com/photo/2018/08/14/13/23/ocean-3605547_960_720.jpg"
r = requests.get(url, stream=True)

with open('image2.jpg', 'wb') as fd:
        for chunk in r.iter_content(chunk_size=128):
                fd.write(chunk)
        fd.close()
```

è¿™æ ·åšçš„å¥½å¤„ï¼Œæˆ‘çŒœæµ‹æœ‰ä¸¤ç‚¹ï¼šä¸€æ˜¯èŠ‚çœå†…å­˜å¼€é”€ï¼›äºŒå¯ä»¥è·å–è¿›åº¦(***é€šè¿‡`r.headers['content-length']`è·å–æ€»é•¿åº¦ä¿¡æ¯***)

ä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•è·å–çš„å›¾åƒä¸ç¬¬ä¸€ç§æ–¹æ³•è·å–çš„å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ‰€ä»¥å°±ä¸è´´æˆªå›¾äº†ã€‚

# ä½¿ç”¨`r.raw`

å¦å¤–ä¸€ç§æ–¹æ³•å°±æ˜¯ä½¿ç”¨`r.raw`ï¼Œå› ä¸ºæˆ‘å¹¶ä¸æ‰“ç®—ç”¨è¿™ç§æ–¹æ³•ï¼Œæ‰€ä»¥åªæ˜¯ç®€å•æµ‹è¯•ä¸€ä¸‹ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼š
* ä½¿ç”¨`r.raw`ï¼Œå¿…é¡»è®¾ç½®`stream=True`
* ä½¿ç”¨`r.raw`ä¹‹å‰ä¸èƒ½ä½¿ç”¨`r.content`ä¹‹ç±»çš„è°ƒç”¨ï¼Œå¦åˆ™ç›¸å½“äºæŠŠè¾“å‡ºè¯»å…‰äº†ã€‚
* ä½¿ç”¨`r.raw.read(10)`è¯»å–æ•°æ®åï¼Œæ•°æ®å‰©ä½™é•¿åº¦ä¼šç›¸åº”çš„å‡å°‘`r.headers['content-length']`ã€‚

requestsæ–‡æ¡£ä¸­è¿˜æœ‰è¿™æ ·ä¸€æ®µï¼š
>An important note about using Response.iter_content versus Response.raw. Response.iter_content will automatically decode the gzip and deflate transfer-encodings. Response.raw is a raw stream of bytes â€“ it does not transform the response content. If you really need access to the bytes as they were returned, use Response.raw.

ä¹Ÿå°±æ˜¯è¯´Response.iter_contentä¼šè‡ªåŠ¨è§£ç gzipå‹ç¼©ç­‰ï¼Œè€ŒResponse.rawå°±æ˜¯åŸå§‹çš„å­—èŠ‚æµã€‚æ‰€ä»¥è¿˜æ˜¯è€å®åœ°ç”¨Response.iter_content æˆ–è€…ç›´æ¥ç”¨Response.contentå§ã€‚ğŸ˜€


# æ€»ç»“

å°½ç®¡è¯»å›¾ç‰‡æœ‰å¾ˆå¤šæ–¹æ³•ï¼Œä½†æ˜¯å› ä¸ºæˆ‘è¦è¯»å–çš„éƒ½æ˜¯ä¸€äº›å°å›¾ç‰‡ï¼Œä¸ä¼šæœ‰å¤šå¤§å†…å­˜å¼€é”€ï¼Œæ‰€ä»¥ç¬¬ä¸€ç§æ–¹æ³•è¶³å¤Ÿäº†ã€‚

ä¸€ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹å°±æ˜¯åœ¨å¤„ç†ä¹‹å‰ï¼Œå…ˆåˆ¤æ–­ä¸€ä¸‹HTTP çŠ¶æ€ç (`r.status_code`)ï¼Œæ­£å¸¸è¿”å›åº”è¯¥éƒ½æ˜¯2XXã€‚

å¤Ÿç”¨å°±å¥½ï¼Œå¦åˆ™åˆå˜æˆå­”ä¹™å·±ç ”ç©¶èŒ´é¦™è±†å‡ ç§å†™æ³•çš„é—®é¢˜äº†ï¼Œç™½ç™½åœ°æµªè´¹æ—¶é—´å’Œç²¾åŠ›ã€‚



# ç›¸å…³é“¾æ¥

* [webpæ ¼å¼](https://baike.baidu.com/item/webp%E6%A0%BC%E5%BC%8F/4077671)
* https://requests.readthedocs.io/en/master/user/quickstart
* [How to download image using requests](https://stackoverflow.com/questions/13137817/how-to-download-image-using-requests)

- - -

This page is synchronized from the post: ['æ¯å¤©è¿›æ­¥ä¸€ç‚¹ç‚¹ï¼šrequests è¯»å–ç½‘ç»œå›¾ç‰‡'](https://steemit.com/@oflyhigh/requests)
