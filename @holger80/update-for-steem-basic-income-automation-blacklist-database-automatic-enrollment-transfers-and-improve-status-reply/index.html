
<!DOCTYPE html>
<html lang="en">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>Update for Steem Basic Income Automation - Blacklist database, automatic enrollment transfers and improve status reply - Holger</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">









<link rel="icon" href="https://www.easyicon.net/api/resizeApi.php?id=1185564&size=32">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    




    
    

    
    
    
    

    
    

<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    


<link rel="stylesheet" href="/@holger80/css/style.css">

<link rel="stylesheet" href="/@holger80/css/bundle.css"></head>
<body class="is-2-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/@holger80/">
            
                <img src="https://avatars0.githubusercontent.com/u/50857551?s=200&v=4" alt="Holger" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item" href="/@holger80/">Home</a>
                
                <a class="navbar-item" href="/@holger80/archives">Archives</a>
                
                <a class="navbar-item" href="/@holger80/categories">Categories</a>
                
                <a class="navbar-item" href="/@holger80/tags">Tags</a>
                
                <a class="navbar-item" href="/@holger80/about">About</a>
                
            </div>
            
            <div class="navbar-end">
                
                
                <a class="navbar-item is-hidden-tablet catalogue" title="Catálogo" href="javascript:;">
                    <i class="fas fa-list-ul"></i>
                </a>
                
                
                <a class="navbar-item search" title="Search" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>

    
    <section class="section">
        <div class="container">
            <div class="columns">
                

                





<div class="column is-4-tablet is-4-desktop is-4-widescreen  has-order-3 column-right is-sticky">
    
        
<div class="card widget" id="toc">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                Catálogo
            </h3>
            <ul class="menu-list"><li>
        <a class="is-flex" href="#Repository">
        <span class="has-mr-6">1</span>
        <span>Repository</span>
        </a></li><li>
        <a class="is-flex" href="#Blacklist-database-added">
        <span class="has-mr-6">2</span>
        <span>Blacklist database added</span>
        </a></li><li>
        <a class="is-flex" href="#Sending-automatic-enrollment-transfer-memos-to-new-members">
        <span class="has-mr-6">3</span>
        <span>Sending automatic enrollment transfer memos to new members</span>
        </a></li><li>
        <a class="is-flex" href="#Improved-sbi-status-replies">
        <span class="has-mr-6">4</span>
        <span>Improved sbi status replies.</span>
        </a></li><li>
        <a class="is-flex" href="#Commits">
        <span class="has-mr-6">5</span>
        <span>Commits</span>
        </a><ul class="menu-list"><li>
        <a class="is-flex" href="#new-sql-table-structure">
        <span class="has-mr-6">5.1</span>
        <span>new sql table structure</span>
        </a></li><li>
        <a class="is-flex" href="#Improve-reply-layout">
        <span class="has-mr-6">5.2</span>
        <span>Improve reply layout</span>
        </a></li><li>
        <a class="is-flex" href="#Add-transfer-memo-database-and-sending-transfers-to-new-members">
        <span class="has-mr-6">5.3</span>
        <span>Add transfer memo database and sending transfers to new members</span>
        </a></li><li>
        <a class="is-flex" href="#Add-blacklist-database">
        <span class="has-mr-6">5.4</span>
        <span>Add blacklist database</span>
        </a></li></ul></li><li>
        <a class="is-flex" href="#GitHub-Account">
        <span class="has-mr-6">6</span>
        <span>GitHub Account</span>
        </a></li></ul>
        </div>
    </div>
</div>


    
    
</div>


                <script src="/@holger80/js/pjax-widget.js"></script>

                <div class="column is-8-tablet is-8-desktop is-8-widescreen has-order-2 column-main"><div class="card">
    
    <div class="card-image">
        <span class="image is-7by1">
            <img class="thumbnail" src="https://cdn.steemitimages.com/DQmVhhf7x6ovMeN9qLV7HSPjNea7FM81rMB9Kkt7wu5sT9F/image.png" alt="Update for Steem Basic Income Automation - Blacklist database, automatic enrollment transfers and improve status reply">
        </span>
    </div>
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                <time class="level-item has-text-grey" datetime="2019-03-18T13:41:51.000Z">2019-03-18</time>
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/@holger80/categories/utopian-io/">utopian-io</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 minutes read (About 866 words)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                Update for Steem Basic Income Automation - Blacklist database, automatic enrollment transfers and improve status reply
            
        </h1>
        <div class="content">
            <p><img src="https://cdn.steemitimages.com/DQmVhhf7x6ovMeN9qLV7HSPjNea7FM81rMB9Kkt7wu5sT9F/image.png" alt=""></p>
<h2 id="Repository"><a href="#Repository" class="headerlink" title="Repository"></a>Repository</h2><p><a href="https://github.com/holgern/steembasicincome" target="_blank" rel="noopener">https://github.com/holgern/steembasicincome</a></p>
<h2 id="Blacklist-database-added"><a href="#Blacklist-database-added" class="headerlink" title="Blacklist database added"></a>Blacklist database added</h2><p>A new blacklist database with a <code>tags</code>, <code>apps</code> and <code>body</code> field was added.<br><img src="https://ipfs.busy.org/ipfs/QmWuD9S6E5HhoTxo4Tr5DkMX4tdi9cirEBikw7s2b1Yxa6" alt="image.png"><br>The blacklisted tags,apps and keywords can be changed anytime directly in the database.</p>
<p>The fields are read out in <code>sbi_stream_post_comment.py</code> and three lists were build:<br></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">blacklist = blacklistStorage.get()</span><br><span class="line"></span><br><span class="line">blacklist_tags = []</span><br><span class="line">for t in blacklist[&quot;tags&quot;].split(&quot;,&quot;):</span><br><span class="line">    blacklist_tags.append(t.strip())</span><br><span class="line"></span><br><span class="line">blacklist_apps = []</span><br><span class="line">for t in blacklist[&quot;apps&quot;].split(&quot;,&quot;):</span><br><span class="line">    blacklist_apps.append(t.strip())</span><br><span class="line"></span><br><span class="line">blacklist_body = []</span><br><span class="line">for t in blacklist[&quot;body&quot;].split(&quot;,&quot;):</span><br><span class="line">    blacklist_body.append(t.strip())</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>The tags from the posts are then checked of one is stored in <code>blacklist_tags</code>.<br>If a blacklisted tag was found, the post will be skipped.<br></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for tag in c[&quot;tags&quot;]:</span><br><span class="line">    if tag is not None and tag.lower() in blacklist_tags:</span><br><span class="line">        skip = True</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>In the next step the app, which was used to create the post, is extracted. As there are some different ways to store the app, the script is doing some checks first:</p>
<figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">json_metadata = c.json_metadata</span><br><span class="line">if isinstance(json_metadata, str):</span><br><span class="line">    try:</span><br><span class="line">        json_metadata = json.loads(json_metadata)</span><br><span class="line">    except:</span><br><span class="line">        json_metadata = {}</span><br><span class="line">if &quot;app&quot; in json_metadata:</span><br><span class="line">    app = json_metadata[&quot;app&quot;]</span><br><span class="line">    if isinstance(app, dict) and &quot;name&quot; in app:</span><br><span class="line">        app = app[&quot;name&quot;]</span><br><span class="line">    if app is not None and isinstance(app, str) and app.find(&quot;/&quot;) &gt; -1:</span><br><span class="line">        app = app.split(&quot;/&quot;)[0]</span><br><span class="line">    if app is not None and isinstance(app, str) and app.lower() in blacklist_apps:</span><br><span class="line">        skip = True</span><br></pre></td></tr></tbody></table></figure>
<p>Finally, the body is scanned for blacklisted words. This is useful for letting a member disabling upvotes for a specific comment, as it is not easily possible to attach tags to a comment (which could be used for disabling upvotes on the comment instead).<br></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for s in blacklist_body:</span><br><span class="line">    if c.body.find(s) &gt; -1:</span><br><span class="line">        skip = True</span><br></pre></td></tr></tbody></table></figure><p></p>
<h2 id="Sending-automatic-enrollment-transfer-memos-to-new-members"><a href="#Sending-automatic-enrollment-transfer-memos-to-new-members" class="headerlink" title="Sending automatic enrollment transfer memos to new members"></a>Sending automatic enrollment transfer memos to new members</h2><p>Enrollment to new member is now done automatically. A new database <code>transfer_memos</code> has been added, in which the memo text for the diffect memo transfer types <code>welcome</code> (is sent to new members), <code>sponsoring</code> (is sent to new sponsored members), <code>sp_delegation</code> (can be sent when a member is delegating SP), <code>update_rshares</code> (can be sent when a member increases their shares), <code>sponsoring_update_rshares</code> (can be sent when a member is sponsored and receive more shares).</p>
<p><img src="https://ipfs.busy.org/ipfs/QmPCFmfXjk38uSCQEK7s6GH9D8iohH3igjs8jkeEYmvftB" alt="image.png"></p>
<p>For each type a new function was created:<br></p><figure class="highlight plain hljs"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def memo_sponsoring(transferMemos, memo_transfer_acc, s, sponsor):</span><br><span class="line">    if &quot;sponsoring&quot; not in transferMemos:</span><br><span class="line">        return</span><br><span class="line">    if transferMemos[&quot;sponsoring&quot;][&quot;enabled&quot;] == 0:</span><br><span class="line">        return</span><br><span class="line">    if memo_transfer_acc is None:</span><br><span class="line">        return    </span><br><span class="line">    try:</span><br><span class="line">        if &quot;%s&quot; in transferMemos[&quot;sponsoring&quot;][&quot;memo&quot;]:</span><br><span class="line">            memo_text = transferMemos[&quot;sponsoring&quot;][&quot;memo&quot;] % sponsor</span><br><span class="line">        else:</span><br><span class="line">            memo_text = transferMemos[&quot;sponsoring&quot;][&quot;memo&quot;]</span><br><span class="line">        memo_transfer_acc.transfer(s, 0.001, &quot;STEEM&quot;, memo=memo_text)</span><br><span class="line">    except:</span><br><span class="line">        print(&quot;Could not sent 0.001 STEEM to %s&quot; % s)</span><br></pre></td></tr></tbody></table></figure><p></p>
<p>The try/except check prevents the script from crashing when for example the active key is wrong, not sufficient STEEM are left on the account or the RC is to low.</p>
<p>It is checked every 144 minutes in <code>sbi_update_member_db.py</code> if new members should be enrolled or if existing member are increasing their sbi units. It is now possible to send everytime a 0.001 STEEM memo with a configurable memo text (the sponsoring account name and the sbi units are added and a %s / %d placeholder is used. A memo is only sent when it is enabled by setting <code>enabled</code> to 1 in the database.</p>
<h2 id="Improved-sbi-status-replies"><a href="#Improved-sbi-status-replies" class="headerlink" title="Improved sbi status replies."></a>Improved sbi status replies.</h2><p>The reply of the <code>!sbi status</code> command has been enhanced.<br><img src="https://ipfs.busy.org/ipfs/QmYCPXJGS9n65wTw9DbTN5ZrUqWBpHSzv9zZTwG3cqQiqz" alt="image.png"></p>
<p>The percentage of <code>subscribed_rshares</code>, <code>delegation_rshares</code>, <code>curation_rshares</code> and <code>other_rshares</code> which build the total SBI upvote value is now shown in the reply to a comment containing <code>!sbi status</code>.</p>
<h2 id="Commits"><a href="#Commits" class="headerlink" title="Commits"></a>Commits</h2><h3 id="new-sql-table-structure"><a href="#new-sql-table-structure" class="headerlink" title="new sql table structure"></a>new sql table structure</h3><ul>
<li><a href="https://github.com/holgern/steembasicincome/commit/b17de9658b1b8ea4f1d6cc455299ba6c1d6f4d3e" target="_blank" rel="noopener">commit b17de96</a><h3 id="Improve-reply-layout"><a href="#Improve-reply-layout" class="headerlink" title="Improve reply layout"></a>Improve reply layout</h3></li>
<li><a href="https://github.com/holgern/steembasicincome/commit/f7b771e216da778f306134326eac8b2528d97017" target="_blank" rel="noopener">commit f7b771e</a><h3 id="Add-transfer-memo-database-and-sending-transfers-to-new-members"><a href="#Add-transfer-memo-database-and-sending-transfers-to-new-members" class="headerlink" title="Add transfer memo database and sending transfers to new members"></a>Add transfer memo database and sending transfers to new members</h3></li>
<li><a href="https://github.com/holgern/steembasicincome/commit/2b7bbcb131302a85f613e74d652bc8e6b5cba492" target="_blank" rel="noopener">commit 2b7bbcb</a></li>
<li>Add flag for transfer memo account</li>
<li>Implement transfer memo functions for the different memo types (welcome, sponsoring, update_shares and sponsoring_update_shares)<h3 id="Add-blacklist-database"><a href="#Add-blacklist-database" class="headerlink" title="Add blacklist database"></a>Add blacklist database</h3></li>
<li><a href="https://github.com/holgern/steembasicincome/commit/2cedbb2a58f38993217dfdd973b96e6a24216204" target="_blank" rel="noopener">commit 2cedbb2</a></li>
<li>votes on posts with a blacklisted content word, a blacklisted tag or app are skipped</li>
<li>sbi status reply improved, it is now shown from where the sbi upvote value is build</li>
</ul>
<h2 id="GitHub-Account"><a href="#GitHub-Account" class="headerlink" title="GitHub Account"></a>GitHub Account</h2><p><a href="https://github.com/holgern" target="_blank" rel="noopener">https://github.com/holgern</a></p>
<hr>
<p>This page is synchronized from the post: <a href="https://steemit.com/@holger80/update-for-steem-basic-income-automation-blacklist-database-automatic-enrollment-transfers-and-improve-status-reply" target="_blank" rel="noopener">&#x2018;Update for Steem Basic Income Automation - Blacklist database, automatic enrollment transfers and improve status reply&#x2019;</a></p>
<script>document.querySelectorAll(".not-gallery-item").forEach(e=>{if(!e.dataset.src)return;const t=document.createElement("img");t.style="display:none !important;",t.src=e.dataset.src,t.addEventListener("error",()=>{t.remove(),e.style.color="inherit",e.style.backgroundImage="none",e.style.background="none"}),t.addEventListener("load",()=>{t.remove()}),document.body.appendChild(t)});</script>
        </div>
        
        <div class="level is-size-7 is-uppercase">
            <div class="level-start">
                <div class="level-item">
                    <span class="is-size-6 has-text-grey has-mr-7">#</span>
                    <a class="has-link-grey -link" href="/@holger80/tags/busy/">busy</a>, <a class="has-link-grey -link" href="/@holger80/tags/development/">development</a>, <a class="has-link-grey -link" href="/@holger80/tags/steembasicincome/">steembasicincome</a>, <a class="has-link-grey -link" href="/@holger80/tags/steemdev/">steemdev</a>, <a class="has-link-grey -link" href="/@holger80/tags/utopian-io/">utopian-io</a>
                </div>
            </div>
        </div>
        
        
        
        
<div class="sharethis-inline-share-buttons"></div>
<script type="text/javascript" src="//platform-api.sharethis.com/js/sharethis.js#property=5ab6f60ace89f00013641890&amp;product=inline-share-buttons" async="async"></script>

        
    </div>
</div>





<div class="card card-transparent">
    <div class="level post-navigation is-flex-wrap is-mobile">
        
        <div class="level-start">
            <a class="level level-item has-link-grey  article-nav-prev" href="/@holger80/update-for-steemengine-token-precision-taken-into-account-and-several-new-cli-commands-added/">
                <i class="level-item fas fa-chevron-left"></i>
                <span class="level-item">Update for steemengine - token precision taken into account and several new CLI commands added</span>
            </a>
        </div>
        
        
        <div class="level-end">
            <a class="level level-item has-link-grey  article-nav-next" href="/@holger80/steem-scot-a-distributor-for-smart-contract-organizational-token/">
                <span class="level-item">steem-scot - a distributor for Smart Contract Organizational Token</span>
                <i class="level-item fas fa-chevron-right"></i>
            </a>
        </div>
        
    </div>
</div>


</div>
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/@holger80/">
                
                    <img src="https://avatars0.githubusercontent.com/u/50857551?s=200&v=4" alt="Holger" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Holger&nbsp;
                Powered by <a href="https://hexo.io/" target="_blank">Hexo</a> & <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>
                
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://creativecommons.org/">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("en_US.UTF-8");</script>


    
    
    
    <script src="/@holger80/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>document.addEventListener("DOMContentLoaded",function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"flex"})});</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>document.addEventListener("DOMContentLoaded",function(){MathJax.Hub.Config({"HTML-CSS":{matchFontHeight:!1},SVG:{matchFontHeight:!1},CommonHTML:{matchFontHeight:!1},tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]]}})});</script>

    
    

<a id="back-to-top" title="Back to Top" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>



    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    
    

    
    
    





    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Type something...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>window.INSIGHT_CONFIG={TRANSLATION:{POSTS:"Entradas",PAGES:"Pages",CATEGORIES:"Categorias",TAGS:"Etiquetas",UNTITLED:"(Untitled)"},CONTENT_URL:"/@holger80/content.json"};</script>



    
<script src="/@holger80/js/bundle.js" defer></script></body>
</html>

